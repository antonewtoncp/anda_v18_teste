<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <template id="report_salary">
            <t t-call="web.html_container">
                <t t-call="web.basic_layout">
                    <div class="header" style="color: #0B74CE">
                        <div class="row b_color">
                            <div class="col-8">
                                <b><span class="text-left" t-field="res_company.name"/></b>
                            </div>
                            <div class="col-4">
                                <ul class="list-inline text-right">
                                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                    |
                                    Pag. <span class="page"/>/<span class="topage"/>
                                </ul>
                            </div>
                        </div>
                        <hr style="display: block; height: 1px;
                            border: 0; border-top: 3px solid #0B74CE;
                            margin: 0; padding: 0;"/>
                        <div class="row mt16">
                            <div class="col-6">
                                <div align="left">
                                    <b class="b_color" style="font-size: 12px">
                                        Folha de Salário a vigorar a partir de
                                        <span t-esc="period"/>
                                    </b>
                                </div>
                            </div>
                            <div class="col-6">
                                <div align="right"><b class="b_color">Valores Expresso em <span
                                        t-esc="res_company.currency_id.symbol"/></b></div>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="page">
                        <style type="text/css">
                            * {padding-bottom: 0 !important;
                            padding-top: 0 !important;
                            margin-bottom: 0 !important;margin-top:0 !important; }
                            hr {
                            display: block; height: 1px;
                            border: 0; border-top: 1px solid #0B74CE;
                            margin: 0; padding: 0;
                            }
                            .b_color{
                            color: #0B74CE;
                            }
                            .border_bottom {border-bottom: solid black 1px;}

                            table {
                            border-spacing: 3px;
                            border-top: 3px solid black;
                            border-collapse:collapse;
                            font-size:10px;
                            }

                            td {
                            border-bottom:0 !important;
                            border-top: 1px solid #B2BABB !important;
                            }

                            th {
                            border-top:0 !important;
                            border-bottom: 1px solid #B2BABB !important;
                            }

                            table, tr, th, td {
                            border-collapse: separate;
                            padding:0px !important;
                            font-weight: bold !important;
                            }

                            .border_top_th{
                            border-top: 1px solid black !important;
                            }

                            .celula-horizontal {                           
                                padding-left: 40px;
                                padding-right: 40px;
                            }
                        </style>
                        <div class="row">
                            <div class="col-6">
                                <table class="table table-sm o_main_table" style="border-top: 0px;">
                                    <tr>
                                        <th style="border: 0 !important">
                                            <img t-att-src="'data:image/png;base64,%s' % to_text(res_company.logo)"
                                                 style="max-height: 60px;"/>

                                            <p>
                                                <span t-field="res_company.name"/>
                                            </p>
                                            <p>
                                                <span t-field="res_company.street"/>,<br/>
                                                <span t-field="res_company.city"/>-
                                                <span t-field="res_company.country_id"/>
                                            </p>
                                            <p>
                                                Contibuinte Fiscal nº
                                                <span t-field="res_company.vat"/>
                                            </p>
                                            <p>
                                                <span t-field="res_company.hr_phone"/>
                                            </p>
                                        </th>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-4">
                                <table class="table table-sm o_main_table" style="border-top: 0px;">
                                    <tr style="color: #0B74CE">
                                        <td colspan="2" style="font-size:18px; border:0px !important;">
                                            Folha de Salário nº:
                                            <t t-esc="slip_run.date_start.month"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border:0px !important;">Funcionários processados:</td>
                                        <td style="border:0px !important;"><span t-esc="len(docs)"/></td>
                                    </tr>
                                    <tr>
                                        <td style="border:0px !important;">Tipo de processamento:</td>
                                        <td style="border:0px !important;">Todos</td>
                                    </tr>
                                    <tr>
                                        <td style="border:0px !important;">Data de processamento:</td>
                                        <td style="border:0px !important;"><span t-field="slip_run.create_date"/></td>
                                    </tr>
                                    <tr>
                                        <td style="border:0px !important;">Moeda:</td>
                                        <td style="border:0px !important;">
                                            <span t-esc="res_company.currency_id.symbol"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-2"></div>
                        </div>
                        <br/>
                        <br/>
                        <div name="table_salary_line" class="row">
                            <div class="col-12">
                                <t t-set="number" t-value="1"/>
                                <t t-set="total_sub_ali" t-value="0"/>
                                <t t-set="total_sub_trans" t-value="0"/>
                                <t t-set="total_sub_fam" t-value="0"/>
                                <t t-set="total_remuneration" t-value="0"/>
                                <t t-set="total_other_remunerations" t-value="0"/>
                                <t t-set="total_misses" t-value="0"/>
                                <t t-set="total_inss" t-value="0"/>
                                <t t-set="total_irt" t-value="0"/>
                                <t t-set="total_extra_deductions" t-value="0"/>
                                <t t-set="total_other_deductions" t-value="0"/>
                                <t t-set="total_paid_amount" t-value="0"/>
                                <t t-set="total_per_line" t-value="0"/>
                                <table id="table2" class="table table-sm o_main_table">
                                    <tr
                                        style="background-color: #E5F1FB; font-weight: bold; border-bottom: 2px solid #0B74CE;">
                                        <th colspan="2" class="text-center"
                                            style="border:none !important;">
                                            <span>Descrições</span>
                                        </th>
                                        <t t-set="colspan_rem" t-value="rem_tam" />

                                        <t t-set="colspan_desc" t-value="des_tam" />


                                        <th t-att-colspan="colspan_rem" class="text-center title"
                                            style="border:none !important;">
                                            <div class="border_bottom">Remunerações</div>
                                        </th>
                                        <th t-att-colspan="colspan_desc" class="text-center title "
                                            style="border:none !important;">
                                            <div class="border_bottom">Descontos</div>
                                        </th>

                                        <th style="border:none !important;"></th>
                                    </tr>
                                   <tr style="font-weight: bold;">
                                        <td
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">Nº
                                            Ordem</td>
                                        <td class="text-left horizontal"
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                            Nome
                                        </td>
                                        <t t-foreach="rules_remuneracao" t-as="rule">
                                            <th class="text-right"
                                                style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                                <span t-esc="rule[1]" />
                                            </th>
                                        </t>
                                        <td class="text-right"
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                            Total</td>
                                        <td class="text-right"
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                            IRT</td>
                                        <t t-foreach="rules_desconto" t-as="rule">
                                            <th class="text-right"
                                                style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                                <t
                                                    t-if="rule[1] == 'Materia coletável Segurança Social'">
                                                    INSS
                                                </t>
                                                <t t-else="">
                                                    <span t-esc="rule[1]" />
                                                </t>
                                            </th>
                                        </t>
                                        <td class="text-right"
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                            Total</td>
                                        <td class="text-right"
                                            style="border-top: 1px solid black !important; border-bottom: 1px solid black !important;">
                                            Líquido</td>
                                    </tr>
                                    <tr t-foreach="docs" t-as="o">
                                        <td class="text-left">
                                            <span t-esc="number" />
                                        </td>
                                        <td class="text-left">
                                            <span t-esc="nomes_formatados[o.id]"/>
                                        </td>

                                        <t t-foreach="rules_remuneracao" t-as="rule">
                                            <td class="text-right">
                                                <t t-set="valor"
                                                    t-value="sum(line.total for line in o.line_ids if line.code == rule[0])" />
                                                <span
                                                    t-esc="'{:,.2f}'.format(valor).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                            </td>
                                        </t>
                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format( abs(o.total_remunerations)).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>
                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format(abs(o.amount_irt)).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>

                                        <t t-foreach="rules_desconto" t-as="rule">
                                            <td class="text-right">
                                                <t t-set="valor"
                                                    t-value="sum(abs(line.total) for line in o.line_ids if line.code == rule[0])" />
                                                <span
                                                    t-esc="'{:,.2f}'.format(valor).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                            </td>
                                        </t>

                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format((abs(o.misses)+abs(o.amount_inss)+abs(o.amount_irt)+abs(o.extra_deductions))).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>
                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format(o.total_paid).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>
                                        <t t-set="number" t-value="number + 1" />
                                        <t t-set="total_sub_ali" t-value="total_sub_ali + o.sub_ali" />
                                        <t t-set="total_sub_trans"
                                            t-value="total_sub_trans + o.sub_trans" />
                                        <t t-set="total_sub_fam" t-value="total_sub_fam + o.sub_fam" />
                                        <t t-set="total_other_remunerations"
                                            t-value="total_other_remunerations + o.total_sub_other" />
                                        <t t-set="total_inss" t-value="total_inss + o.amount_inss" />
                                        <t t-set="total_irt" t-value="total_irt + o.amount_irt" />
                                        <t t-set="total_misses" t-value="total_misses + o.misses" />
                                        <t t-set="total_other_deductions"
                                            t-value="total_other_deductions + o.extra_deductions" />
                                        <t t-set="total_paid_amount"
                                            t-value="total_paid_amount + o.total_paid" />
                                        <t t-set="total_remuneration"
                                            t-value="total_remuneration + o.remuneration" />
                                        <t t-set="total_per_line"
                                            t-value="total_per_line + o.total_remunerations" />
                                        <t t-set="payslips_reference" t-value="o.number" />
                                        <t t-set="write_date" t-value="o.write_date" />
                                    </tr>
                                     <tr
                                        style="background-color:#61c938; font-weight:bold; border-top: 2px solid #28a745;">
                                        <td colspan="2" class="text-right">Totais</td>
                                        <t t-foreach="rules_remuneracao" t-as="rule">
                                            <td class="text-right">
                                                <t t-set="valor_total"
                                                    t-value="sum(sum(line.total for line in o.line_ids if line.code == rule[0]) for o in docs)" />
                                                <span
                                                    t-esc="'{:,.2f}'.format(valor_total).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                            </td>
                                        </t>

                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format(total_per_line).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>

                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format(-total_irt).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>

                                        <t t-foreach="rules_desconto" t-as="rule">
                                            <td class="text-right">
                                                <t t-set="valor_total"
                                                    t-value="sum(sum(abs(line.total) for line in o.line_ids if line.code == rule[0]) for o in docs)" />
                                                <span
                                                    t-esc="'{:,.2f}'.format(valor_total).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                            </td>
                                        </t>
                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format((abs(total_other_deductions) + abs(total_irt) + abs(total_inss) + abs(total_misses))).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>
                                        <td class="text-right">
                                            <span
                                                t-esc="'{:,.2f}'.format(total_paid_amount).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                                        </td>
                                    </tr>
                                </table>
                                <br/>
                                <br/>
                            </div>
                        </div>
                        <div name="assign_name" class="row">
                            <div class="col-4" style="font-size:12px !important;">
                                <p align="center">Processado por</p>
                                <p align="center" class="mt-2">___________________________________</p>
                                <p align="center" class="mt-3">
                                    <span t-field="slip_run.create_uid"/>
                                </p>
                            </div>
                            <div class="col-4" style="font-size:12px !important;">
                                <p align="center">O(A) Responsável do RH</p>
                                <p align="center" class="mt-2">___________________________________</p>
                                <p align="center" class="mt-3">
                                    <span t-field="res_company.hr_manager"/>
                                </p>
                            </div>
                            <div class="col-4" style="font-size:12px !important;">
                                <p align="center">P'las Finanças</p>
                                <p align="center" class="mt-2">___________________________________</p>
                                <p align="center" class="mt-3">
                                    <span t-field="res_company.hr_general_manager"/>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        <div class="text-right" style="font-size:10px">
                            <b>©COMPLLEXUS</b>
                        </div>
                    </div>
                </t>
            </t>
        </template>

    </data>
</odoo>
