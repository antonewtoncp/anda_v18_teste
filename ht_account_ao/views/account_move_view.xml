<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="account_move_form_inherit" model="ir.ui.view">
            <field name="name">account.move.inherit.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <!-- <xpath expr="//field[@name='partner_id']" position="attributes">
                     <attribute name="domain">[('company_id','in',[company_id, False]),('customer_rank','>', 0)]</attribute>
                 </xpath>-->
                <xpath expr="//field[@name='partner_id']" position="replace">
                    <field name="partner_id"
                        invisible="move_type not in ('out_invoice', 'out_refund', 'out_receipt')"
                        domain="[('customer_rank','>',0)]"
                        placeholder ="Pesquise pelo nome do Cliente ou NIF"
                        context="{'search_default_customer': 1}"
                        options="{'no_create': True, 'no_create_edit': True}"/>

                    <field name="partner_id"
                        invisible="move_type not in ('in_invoice', 'in_refund', 'in_receipt')"
                        domain="[('supplier_rank','>',0)]"
                        placeholder ="Pesquise pelo nome do Fornecedor ou NIF"
                        context="{'search_default_supplier': 1}"
                        options="{'no_create': True, 'no_create_edit': True}"/>
                </xpath>


                <xpath expr="//form//h1" position="after">
                    <div invisible="state in ['posted','cancel']" class="col-md-4" style="justify-self: end;margin-bottom: 30px;">
                        <i>"A Factura em estado <b style="color:red">RASCUNHO</b>,
                            <b>não tem número</b>
                            e pode ser
                            totalmente alterada ou seja todos os campos estarão
                            disponível para uma possível alteração."
                        </i>
                    </div>
                    <div invisible="state in ['draft','cancel']" class="col-md-4" style="justify-self: end;margin-bottom: 30px;">
                        <i>"A Factura em estado <b style="color:red">PUBLICADA</b>,
                            <b>Já Foi Validada (Documento Assinado)</b>
                            e não pode mais ser alterada. <b>AGT decreto nº 74-19</b>" Documentos Assinados
                            não podem ser modificados."
                        </i>
                    </div>
                </xpath>
                <xpath expr="//group[@id='header_right_group']/div" position="before">
                    <field name="year" required="1" domain="[('company_id','=', company_id)]" options="{'no_open': True, 'no_create': True}" string="Ano Fiscal" invisible="move_type in  ('out_invoice','in_invoice','in_refund', 'out_refund', 'out_receipt')" readonly="state!='draft'" />
                    <field name="period" required="1" domain="[('year','=', year)]" options="{'no_open': True, 'no_create': True}" string="Período" invisible="move_type in ('out_invoice','in_invoice','in_refund', 'out_refund', 'out_receipt')" readonly="state!='draft'" />
                </xpath>
                <xpath expr="//field[@name='line_ids']//field[@name='name']" position="after">
                    <field name="has_cost_center" invisible="1"/>
                    <field name="has_cash_flow" invisible="1"/>
                    <field name="has_iva" invisible="1"/>
                    <field name="has_fiscal_plan" invisible="1"/>

                    <field name="fiscal_plan" invisible="has_fiscal_plan==False" required="has_fiscal_plan!=False" options="{'no_open': True, 'no_create': True}"/>
                    <field name="cash_flow" options="{'no_open': True, 'no_create': True}"/>
                    <field name="iva_plan" invisible="has_iva==False" required="has_iva!=False" options="{'no_open': True, 'no_create': True}"/>
                    <field name="cost_center" invisible="has_cost_center==False" required="has_cost_center!=False" options="{'no_open': True, 'no_create': True}"/>

                </xpath>
                <xpath expr="//sheet//widget" position="after">
                    <widget name="web_ribbon" title="Cancelado" invisible="state != 'cancel' or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>
                    <widget name="web_ribbon" title="Aberto" invisible="state != 'draft' or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>
                </xpath>
                <xpath expr="//field[@name='invoice_payments_widget']" position="after">
                    <field name="payment_difference" invisible="1" class="oe_subtotal_footer_separator"/>
                </xpath>
                <xpath expr="//field[@name='payment_reference']" position="after">
                    <field name="has_cost_center" invisible="1"/>
                    <field name="cost_center" invisible="has_cost_center==False" required="has_cost_center!=False" options="{'no_create': True, 'no_open': True}" readonly="state!='draft'"/>
                </xpath>

            </field>
        </record>



    </data>
</odoo>